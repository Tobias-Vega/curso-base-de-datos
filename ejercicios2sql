-- Obtener a todos los usuarios que han realizado un préstamo en los últimos diez días.

SELECT u.nombre, u.apellidos, u.username FROM usuarios u JOIN libros_usuarios lu ON u.usuario_id = lu.usuario_id WHERE lu.fecha_creacion >= CURDATE() - INTERVAL 10 DAY GROUP BY u.usuario_id;

-- Obtener a todos los usuarios que no ha realizado ningún préstamo.
SELECT u.nombre, u.apellidos, u.username FROM usuarios u LEFT JOIN libros_usuarios lu ON u.usuario_id = lu.usuario_id WHERE lu.libro_id IS NULL;

-- Listar de forma descendente a los cinco usuarios con más préstamos.
SELECT u.nombre, u.apellidos, u.username, COUNT(*) AS cantidad_prestamos FROM libros_usuarios lu JOIN usuarios u ON u.usuario_id = lu.usuario_id GROUP BY lu.usuario_id ORDER BY cantidad_prestamos DESC LIMIT 5;

-- Listar 5 títulos con más préstamos en los últimos 30 días.
SELECT titulo, COUNT(lu.libro_id) AS prestamos FROM libros l JOIN libros_usuarios lu ON lu.libro_id = l.libro_id WHERE lu.fecha_creacion >= CURDATE() - INTERVAL 30 DAY GROUP BY lu.libro_id ORDER BY lu.libro_id DESC LIMIT 5;

-- Obtener el título de todos los libros que no han sido prestados.
SELECT l.titulo FROM libros l LEFT JOIN libros_usuarios lu ON lu.libro_id = l.libro_id WHERE lu.libro_id IS NULL;

-- Obtener la cantidad de libros prestados el día de hoy.
SELECT COUNT(libro_id) AS cantidad_prestados_hoy FROM libros_usuarios WHERE DATE(fecha_creacion) = CURDATE();

-- Obtener la cantidad de libros prestados por el autor con id 1.
SELECT a.nombre, COUNT(lu.libro_id) AS cantidad_prestada FROM autores a JOIN libros l   ON a.autor_id = l.autor_id JOIN libros_usuarios lu ON lu.libro_id = l.libro_id WHERE a.autor_id = 1;

-- Obtener el nombre completo de los cinco autores con más préstamos.
SELECT CONCAT(a.nombre, ' ', a.apellido) AS nombre_autor, COUNT(lu.libro_id) AS cantidad_prestamos FROM autores a JOIN libros l ON l.autor_id = a.autor_id JOIN libros_usuarios lu ON lu.libro_id = l.libro_id GROUP BY a.autor_id ORDER BY cantidad_prestamos DESC LIMIT 5;

-- Obtener el título del libro con más préstamos esta semana.

SELECT l.titulo, COUNT(lu.libro_id) AS cantidad_prestada FROM libros l JOIN libros_usuarios lu ON l.libro_id = lu.libro_id WHERE lu.fecha_creacion >= CURDATE() - INTERVAL 7 DAY GROUP BY lu.libro_id ORDER BY cantidad_prestada DESC LIMIT 1;